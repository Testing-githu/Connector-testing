{
	"appsUsed":[
		"storage_by_unifyapps"
	],
	"createdTime":1747000729994,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1758650455164,
		"deployedBy":-1,
		"deployedDefinitionId":"68d2e0571bf7400a256cebf3",
		"status":"DEPLOYED",
		"version":72,
		"workflowVersion":112
	},
	"edges":[
		{
			"fromNodeId":"GpPp2",
			"priority":0,
			"skip":false,
			"toNodeId":"AU2XH",
			"type":"next"
		},
		{
			"fromNodeId":"AU2XH",
			"priority":0,
			"skip":false,
			"toNodeId":"oCvHo",
			"type":"next"
		},
		{
			"fromNodeId":"oCvHo",
			"priority":0,
			"skip":false,
			"toNodeId":"O9a4D",
			"type":"next"
		},
		{
			"fromNodeId":"O9a4D",
			"priority":0,
			"skip":false,
			"toNodeId":"uwUFu",
			"type":"next"
		},
		{
			"fromNodeId":"uwUFu",
			"priority":0,
			"skip":false,
			"toNodeId":"1fKko",
			"type":"next"
		},
		{
			"fromNodeId":"1fKko",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"Oqpz0",
			"type":"if"
		},
		{
			"fromNodeId":"Oqpz0",
			"priority":0,
			"skip":false,
			"toNodeId":"8dmtm",
			"type":"next"
		},
		{
			"fromNodeId":"8dmtm",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"IayK6",
			"type":"if"
		},
		{
			"fromNodeId":"IayK6",
			"priority":0,
			"skip":false,
			"toNodeId":"IpVpw",
			"type":"next"
		},
		{
			"fromNodeId":"IpVpw",
			"priority":0,
			"skip":false,
			"toNodeId":"1aRDq",
			"type":"next"
		},
		{
			"fromNodeId":"1aRDq",
			"priority":0,
			"skip":false,
			"toNodeId":"AUynK",
			"type":"next"
		},
		{
			"fromNodeId":"8dmtm",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"AUynK",
			"type":"next"
		},
		{
			"fromNodeId":"AUynK",
			"priority":0,
			"skip":false,
			"toNodeId":"mVYSJ",
			"type":"next"
		},
		{
			"fromNodeId":"mVYSJ",
			"priority":0,
			"skip":false,
			"toNodeId":"vtZuM",
			"type":"next"
		},
		{
			"fromNodeId":"vtZuM",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"34eTT",
			"type":"if"
		},
		{
			"fromNodeId":"vtZuM",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"NGH6j",
			"type":"next"
		},
		{
			"fromNodeId":"34eTT",
			"priority":0,
			"skip":false,
			"toNodeId":"hIFiy",
			"type":"next"
		},
		{
			"fromNodeId":"NGH6j",
			"priority":0,
			"skip":false,
			"toNodeId":"hIFiy",
			"type":"next"
		},
		{
			"fromNodeId":"1fKko",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"hIFiy",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"67b3331d5e9b4f0225bf8276",
	"lastModifiedBy":1,
	"lcName":"publishcitations tool",
	"modifiedTime":1758700909580,
	"name":"publishCitations Tool",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":16,
				"resourceName":"callables_from_interface"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"GpPp2",
			"index":1,
			"inputs":{
				"result":{
					"additionalProperties":false,
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"type":"object",
					"properties":{
						"toolOutput":{
							"type":"string",
							"title":"toolOutput"
						},
						"success":{
							"type":"boolean",
							"title":"Success"
						},
						"error":{
							"type":"string",
							"title":"Error"
						}
					},
					"required":[]
				},
				"callableInterfaceId":"679484ef9c8ab5620dca9609",
				"setup":{
					"additionalProperties":false,
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"type":"object",
					"properties":{
						"toolId":{
							"type":"string",
							"title":"toolId"
						},
						"toolInputs":{
							"type":"object",
							"title":"toolInputs"
						},
						"triggeredByAgentId":{
							"type":"string",
							"title":"Triggered By Agent Id"
						},
						"agentResponseMessageId":{
							"type":"string",
							"title":"Agent Response Message Id"
						},
						"caseId":{
							"type":"string",
							"title":"Case Id"
						},
						"executeUsingModel":{
							"type":"string",
							"title":"Execute Using Model"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger interface",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"variable_by_unifyapps_get_session_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"AU2XH",
			"index":2,
			"inputs":{
				"variableSchema":{
					"type":"object",
					"properties":{
						"caseId":{
							"type":"string",
							"title":"Case Id"
						}
					},
					"additionalProperties":false,
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"caseId",
			"title":"Get Session Variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":17,
				"resourceName":"storage_by_unifyapps_get_record_by_id",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"oCvHo",
			"index":3,
			"inputs":{
				"object_type":"e_ai_agent_conversation_state",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"id":"{{ AU2XH.outputs.caseId }}",
				"readThroughSessionVariables":false
			},
			"skip":false,
			"subTitle":"conv state",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":11,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"O9a4D",
			"index":4,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"chunkIds":{
							"type":"array",
							"items":{
								"type":"integer"
							},
							"title":"Chunk Ids"
						},
						"answer":{
							"type":"string",
							"title":"Answer"
						},
						"chartId":{
							"type":"string",
							"title":"Chart Id"
						},
						"toolInputs":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"toolInputs"
						}
					},
					"additionalProperties":false,
					"required":[
						"chunkIds",
						"answer",
						"chartId"
					]
				},
				"input":{
					"type":"object",
					"properties":{
						"toolInputs":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Tool Inputs"
						}
					},
					"additionalProperties":false,
					"required":[
						"toolInputs"
					]
				},
				"compile_static":false,
				"code":"if(!binding.hasVariable('toolInputs')){\n  return [:]\n}\ndef tmp = [chunkIds: toolInputs.chunkIds?.collect { it as Integer }, answer:toolInputs.answer, chartId:toolInputs.chartId]\ntoolInputs.remove(\"answer\")\ntmp[\"toolInputs\"] = toolInputs\nreturn tmp",
				"parameters":{
					"toolInputs":"{{ GpPp2.outputs.toolInputs }}"
				}
			},
			"skip":false,
			"subTitle":"Get chunkIds",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":72,
				"resourceName":"storage_by_unifyapps_fetch_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"uwUFu",
			"index":5,
			"inputs":{
				"triggerInputCondition":{
					"filters":[
						{
							"property":"properties_chunkNumber",
							"filter":{
								"operator":"IN",
								"value":"{{ O9a4D.outputs.result.chunkIds }}"
							}
						},
						{
							"property":"properties_caseId",
							"filter":{
								"operator":"EQUAL",
								"value":"{{ AU2XH.outputs.caseId }}"
							}
						}
					],
					"operator":"AND"
				},
				"object_type":"citation_store",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"page":{
					"paginateBy":"OFFSET",
					"limit":20
				},
				"numberOfRecordsToFetch":"MULTIPLE",
				"includeTotalCount":false
			},
			"skip":false,
			"subTitle":"Storage by UnifyApps",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":71,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"1fKko",
			"index":6,
			"inputs":{
				"filters":[
					{
						"property":"{{ uwUFu.outputs.objects[0].properties.columnData[0] }}",
						"filter":{
							"operator":"MISSING"
						}
					},
					{
						"property":"1",
						"filter":{
							"operator":"EQUAL",
							"value":"1"
						}
					}
				],
				"operator":"OR"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":11,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"Oqpz0",
			"index":7,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"references":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"References"
						}
					},
					"additionalProperties":false,
					"required":[
						"references"
					]
				},
				"input":{
					"type":"object",
					"properties":{
						"chunks":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Chunks"
						}
					},
					"additionalProperties":false,
					"required":[
						"chunks"
					]
				},
				"compile_static":false,
				"code":"\nMap<String, Object> references = new HashMap<>()\nList<Object> finalReferenceList = new ArrayList<>()\nif (!binding.hasVariable(\"chunks\")){\n    return [:]\n}\n\ndef advancedTrim = { text ->\n    if (!text) return \"\"\n    \n    return text\n        .replaceAll(/(?s)Chunk Document Topic:.*?Chunk Context:/, \"\")\n        .replaceAll(/(?m)^Chunk Context:.*\\n?/, \"\")\n        .replaceAll(/^[\\s\\u200B-\\u200D\\uFEFF]+|[\\s\\u200B-\\u200D\\uFEFF]+$/, \"\") \n}\n\ndef removeSymbols(String str) {\n    if (!str) return \"\"\n    return str.replaceAll(/[#\\-*%_]/, '')\n}\n\ndef removeChunk(String str){\n    return str?.replaceAll(\"chunk\", \"document\")\n}\n\ndef removeMetadata(String str) {\n    if (!str) return \"\"\n    return str.replaceAll(/(?s)<metadata>.*?<\\/metadata>/, \"\").trim()\n}\n\nint ctr = 0\nfor (chunk in chunks) {\n    if (chunk == null) {\n        continue\n    }\n\n    ctr++\n    def metadata = chunk.metadata ?: [:]\n    def chunkContent = chunk.content\n    def trimmedContent = advancedTrim(chunkContent ?: \"\")\n    def removedSymbolStr = removeSymbols(trimmedContent)\n    def finalContent = removeMetadata(removedSymbolStr)\n    finalContent = removeChunk(finalContent)\n\n    def chunkIdentifier = metadata.get(\"name\") ?: \"CHUNK_${ctr}\" // Assign identifier'\n    def chunkNumber = chunk.chunkNumber\n    def chunkId = chunk.chunkId\n\n    // Ensure metadata does not contain chunkId\n    metadata.remove(\"chunkId\")\n\n    def chunkContents = []\n    def chunkDetails = []\n    def existingChunkMetadata = references.get(chunkIdentifier)\n\n    if (existingChunkMetadata != null) {\n        chunkContents.addAll(existingChunkMetadata[\"chunkContents\"] ?: [])\n        chunkDetails.addAll(existingChunkMetadata[\"chunkDetails\"] ?: [])\n    }\n\n    chunkContents.add(finalContent ?: \"\")\n    chunkDetails.add([\n        \"chunkNumber\": chunkNumber,\n        \"chunkContent\": finalContent,\n        \"chunkId\": chunkId\n    ]) \n    metadata[\"chunkContents\"] = chunkContents\n    metadata[\"chunkDetails\"] = chunkDetails\n\n    references.put(chunkIdentifier, metadata)\n}\n\n// Convert map values to final reference list\nfinalReferenceList.addAll(references.values())\n\nreturn [\"references\": finalReferenceList]",
				"parameters":{
					"chunks":{
						"source":"{{ uwUFu.outputs.objects }}",
						"ua:type":"mappedArray",
						"items":"{{ uwUFu.outputs.objects[0].properties }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Get citations",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":77,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"8dmtm",
			"index":8,
			"inputs":{
				"filters":[
					{
						"property":"{{ GpPp2.outputs.agentResponseMessageId }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":82,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"8dmtm@1fKko@kFhpo-1@y@y",
			"id":"IayK6",
			"index":9,
			"inputs":{
				"automationId":"67bdeaa2ba32d908560a258c",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"chunkMetadata":{
						"source":"{{ Oqpz0.outputs.result.references }}",
						"ua:type":"mappedArray",
						"items":"{{ Oqpz0.outputs.result.references[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":82,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"8dmtm@1fKko@kFhpo-1@y@y",
			"id":"IpVpw",
			"index":10,
			"inputs":{
				"automationId":"67bddfb5ac77be6d502052c7",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"coPilotBlock":"{{ IayK6.outputs.citationBlock }}",
					"messageId":"{{ GpPp2.outputs.agentResponseMessageId }}",
					"caseId":"{{ AU2XH.outputs.caseId }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":80,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"8dmtm@1fKko@kFhpo-1@y@y",
			"id":"1aRDq",
			"index":11,
			"inputs":{
				"result":{
					"success":true,
					"toolOutput":"citations published"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":199,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"AUynK",
			"index":12,
			"inputs":{
				"automationId":"67f439a9faf9a1695c2e7fa9",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"aiAgentId":"{{ GpPp2.outputs.triggeredByAgentId }}",
					"answer":"{{ O9a4D.outputs.result.answer }}"
				}
			},
			"skip":true,
			"subTitle":"Guardrail on Answer",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"conv_ai_by_unifyapps",
				"resourceVersion":50,
				"resourceName":"conv_ai_by_unifyapps_publish_response",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"mVYSJ",
			"index":13,
			"inputs":{
				"callableInterfaceId":"__ua__publish_response_interface",
				"parameters":{
					"responses":[
						{
							"content":"{{ AUynK.outputs.response }}"
						}
					],
					"caseId":"{{ AU2XH.outputs.caseId }}",
					"publishToEndUser":false
				}
			},
			"skip":false,
			"subTitle":"Conversation AI by UnifyApps",
			"title":"Publish Response",
			"type":"CALL_INTERFACE_WORKFLOW"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":55,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"vtZuM",
			"index":14,
			"inputs":{
				"filters":[
					{
						"property":"{{ mVYSJ.outputs.messageId }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"messageId present ?",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.updateFields.items.fieldName",
					"root.updateFields.items.actionType"
				]
			},
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":438,
				"resourceName":"storage_by_unifyapps_update_record_fields_by_id",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"vtZuM@1fKko@kFhpo-1@y@y",
			"id":"34eTT",
			"index":15,
			"inputs":{
				"recordId":"{{ mVYSJ.outputs.messageId }}",
				"writeThroughSessionVariables":true,
				"object_type":"service_hub_message",
				"skipPermissionCheck":false,
				"updateFields":[
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolName",
						"actionType":"SET",
						"setValue":"PublishCitations"
					},
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolId",
						"actionType":"SET",
						"setValue":"{{ GpPp2.outputs.toolId }}"
					},
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolOutput",
						"actionType":"SET",
						"setValue":"Published Citations to User"
					},
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolInput",
						"actionType":"SET",
						"setValue":"{{ O9a4D.outputs.result.toolInputs }}"
					}
				]
			},
			"skip":false,
			"subTitle":"update tool Usage",
			"title":"Update an existing record's fields",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":57,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"vtZuM@1fKko@kFhpo-1@y@n",
			"id":"NGH6j",
			"index":16,
			"inputs":{
				"result":{
					"success":true
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":17,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"hIFiy",
			"index":17,
			"inputs":{
				"result":{
					"success":true,
					"toolOutput":"Published citations"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":1,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":false,
		"enableRunLogging":false,
		"enableVariableLogging":false,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		"AI Agent",
		"Internal"
	],
	"version":113
}