{
	"appsUsed":[
		"storage_by_unifyapps",
		"tavily"
	],
	"createdTime":1759854454576,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1759854454677,
		"deployedBy":0,
		"deployedDefinitionId":"68e53f76cb47412c05544049",
		"status":"DEPLOYED",
		"version":1,
		"workflowVersion":5
	},
	"edges":[
		{
			"fromNodeId":"n_CtcTQ",
			"priority":0,
			"skip":false,
			"toNodeId":"RkGgx",
			"type":"next"
		},
		{
			"fromNodeId":"RkGgx",
			"priority":0,
			"skip":false,
			"toNodeId":"KS8hc",
			"type":"next"
		},
		{
			"fromNodeId":"KS8hc",
			"priority":0,
			"skip":false,
			"toNodeId":"MvWJz",
			"type":"next"
		},
		{
			"fromNodeId":"MvWJz",
			"priority":0,
			"skip":false,
			"toNodeId":"B42S5",
			"type":"next"
		},
		{
			"fromNodeId":"B42S5",
			"priority":0,
			"skip":false,
			"toNodeId":"LpZOz",
			"type":"next"
		},
		{
			"fromNodeId":"LpZOz",
			"priority":0,
			"skip":false,
			"toNodeId":"z4F2m",
			"type":"next"
		},
		{
			"fromNodeId":"z4F2m",
			"priority":0,
			"skip":false,
			"toNodeId":"h9R03",
			"type":"loop"
		},
		{
			"fromNodeId":"h9R03",
			"priority":0,
			"skip":false,
			"toNodeId":"FW2ke",
			"type":"next"
		},
		{
			"fromNodeId":"FW2ke",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"TWO8C",
			"type":"if"
		},
		{
			"fromNodeId":"TWO8C",
			"priority":0,
			"skip":false,
			"toNodeId":"7txbk",
			"type":"next"
		},
		{
			"fromNodeId":"FW2ke",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"7txbk",
			"type":"next"
		},
		{
			"fromNodeId":"7txbk",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"z4F2m",
			"type":"next"
		},
		{
			"fromNodeId":"z4F2m",
			"priority":0,
			"skip":false,
			"toNodeId":"CWe4P",
			"type":"next"
		},
		{
			"fromNodeId":"CWe4P",
			"priority":0,
			"skip":false,
			"toNodeId":"n_iPDOW",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"VIEW_RUNS",
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"68e4108255eefd25348624f9",
	"lastModifiedBy":1,
	"lcName":"perform tavily websearch",
	"modifiedTime":1759920866668,
	"name":"Perform Tavily Websearch",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":167,
				"resourceName":"callables_from_interface"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"n_CtcTQ",
			"index":1,
			"inputs":{
				"result":{
					"additionalProperties":false,
					"type":"object",
					"required":[],
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"properties":{
						"output":{
							"type":"string",
							"title":"output"
						}
					}
				},
				"callableInterfaceId":"68e4065055eefd253485c41e",
				"setup":{
					"additionalProperties":false,
					"type":"object",
					"required":[],
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"properties":{
						"query":{
							"type":"string",
							"title":"query"
						},
						"modelId":{
							"type":"string",
							"title":"modelId"
						},
						"caseId":{
							"type":"string",
							"title":"caseId"
						},
						"aiAgentId":{
							"type":"string",
							"title":"aiAgentId"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger interface",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"tavily",
				"resourceVersion":13,
				"connectionId":"68d5711b620c123d9383788c",
				"resourceName":"tavily_execute_search_query",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"RkGgx",
			"index":2,
			"inputs":{
				"search_depth":"advanced",
				"time_range":"week",
				"include_answers":true,
				"query":"{{ n_CtcTQ.outputs.query }}",
				"topic":"general"
			},
			"skip":false,
			"subTitle":"Tavily",
			"title":"Search query",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.urls.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":8,
				"resourceName":"code_by_unifyapps_python",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"KS8hc",
			"index":3,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"favicon":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Favicon"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"urls":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Urls"
						}
					}
				},
				"configurationMode":"DEFAULT",
				"code":"import requests\nfrom bs4 import BeautifulSoup\nfrom urllib.parse import urljoin, urlparse\n\nheaders = {\n    'User-Agent': (\n        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 '\n        '(KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36'\n    ),\n    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n    'Accept-Language': 'en-US,en;q=0.9',\n    'Accept-Encoding': 'gzip, deflate, br',\n    'Connection': 'keep-alive',\n    'Upgrade-Insecure-Requests': '1',\n    'Cache-Control': 'max-age=0',\n    'Referer': 'https://google.com'\n}\ntimeout = 10\nselectors = [\n    (\"link\", {\"rel\": \"icon\"}),\n    (\"link\", {\"rel\": \"shortcut icon\"}),\n    (\"link\", {\"rel\": \"apple-touch-icon\"}),\n    (\"link\", {\"rel\": \"apple-touch-icon-precomposed\"}),\n]\n\nif 'urls' in locals():\n    results = []\n\n    for url in urls:\n        favicon_url = None\n        error = None\n        parsed = urlparse(url)\n        base = f\"{parsed.scheme}://{parsed.netloc}\"\n        try:\n            resp = requests.get(url, timeout=timeout, headers=headers)\n            resp.raise_for_status()\n            soup = BeautifulSoup(resp.text, \"html.parser\")\n            for tag, attrs in selectors:\n                el = soup.find(tag, attrs=attrs)\n                if el and el.get(\"href\"):\n                    potential_url = urljoin(base, el[\"href\"])\n                    try:\n                        icon_resp = requests.get(potential_url, timeout=timeout, headers=headers)\n                        if icon_resp.status_code == 200:\n                            content_type = icon_resp.headers.get('content-type', '').lower()\n                            if 'image/' in content_type:\n                                favicon_url = potential_url\n                                break \n                    except requests.RequestException:\n                        continue \n\n        except requests.RequestException as e:\n            error = str(e)\n\n        if not favicon_url:\n            # Use Google favicon fallback\n            favicon_url = f\"https://www.google.com/s2/favicons?domain={parsed.netloc}&sz=64\"\n\n        result = {\n            \"favicon\": favicon_url,\n        }\n        if error:\n            result[\"error\"] = error\n\n        results.append(result)\n\n    result = {\n        \"favicon\": results\n    }\nelse:\n    result = {\n        \"favicon\": []\n    }",
				"isAsync":false,
				"python_version":"3.12",
				"captureStdOutput":false,
				"parameters":{
					"urls":{
						"source":"{{ RkGgx.outputs.results }}",
						"ua:type":"mappedArray",
						"items":"{{ RkGgx.outputs.results[0].url }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Get favicon",
			"title":"Execute Python script",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":237,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"MvWJz",
			"index":4,
			"inputs":{
				"automationId":"6801f34a8136c62fb3014199",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"aiAgentId":"{{ n_CtcTQ.outputs.aiAgentId }}",
					"results":{
						"source":"{{ RkGgx.outputs.results }}",
						"ua:type":"mappedArray",
						"items":"{{ RkGgx.outputs.results[0] }}"
					},
					"favicon":{
						"source":"{{ KS8hc.outputs.result.favicon }}",
						"ua:type":"mappedArray",
						"items":"{{ KS8hc.outputs.result.favicon[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Analyzing block",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.favicon.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":360,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"B42S5",
			"index":5,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"chunks":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"chunkMetadata":{
										"type":"object",
										"properties":{},
										"additionalProperties":false,
										"title":"Chunk Metadata"
									},
									"content":{
										"type":"string",
										"title":"Content"
									}
								},
								"additionalProperties":false,
								"required":[
									"chunkMetadata",
									"content"
								]
							},
							"title":"Chunks"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"input":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Input"
						},
						"favicon":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Favicon"
						}
					}
				},
				"code":"def results = (input?.results as List) ?: []\n\ndef favicons = binding.hasVariable('favicon') ? favicon as List : []\n\ndef chunks = []\n\nfor (int idx = 0; idx < results.size(); idx++) {\n    def item = results[idx]\n    // pick the matching favicon entry by index, or fall back to empty string\n    def iconUrl = (idx < favicons.size() && favicons[idx]?.favicon) ? favicons[idx].favicon : \"\"\n\n    chunks << [\n        chunkMetadata: [\n            chunkContents   : item.content ? [ item.content ] : [],\n            name            : item?.title,\n            title           : item?.title,\n            referenceUrl    : item?.url,\n            websiteUrl      : item?.url,\n            uniqueEntityId  : item?.url,\n            sourceType      : \"WEBSITE\",\n            iconUrl         : iconUrl\n        ],\n        content: item?.content ?: \"\"\n    ]\n}\n\nreturn [ chunks: chunks ]",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"input":"{{ RkGgx.outputs }}",
					"favicon":{
						"source":"{{ KS8hc.outputs.result.favicon }}",
						"ua:type":"mappedArray",
						"items":"{{ KS8hc.outputs.result.favicon[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Make chunks from output",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":2,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"LpZOz",
			"index":6,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"counter":{
							"type":"integer",
							"title":"Counter"
						}
					},
					"required":[]
				}
			},
			"inputs":{},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"counter":{
							"type":"integer",
							"title":"Counter"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Variable ",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":73,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"z4F2m",
			"index":7,
			"inputs":{
				"repeatMode":"SINGLE",
				"listSource":"{{ B42S5.outputs.result.chunks }}",
				"captureIterations":false
			},
			"skip":false,
			"subTitle":"relevant content",
			"title":"For loop",
			"type":"LOOP"
		},
		{
			"context":{
				"appName":"utility_by_unifyapps",
				"resourceVersion":72,
				"resourceName":"utility_by_unifyapps_sequence_generator",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"z4F2m@_cdjo3-1@l",
			"id":"h9R03",
			"index":8,
			"inputs":{
				"sequenceName":"{{ n_CtcTQ.outputs.caseId }}_ChunkNumber"
			},
			"skip":false,
			"subTitle":"Utility by UnifyApps",
			"title":"Sequence Generator",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":71,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"z4F2m@_cdjo3-1@l",
			"id":"FW2ke",
			"index":9,
			"inputs":{
				"filters":[
					{
						"property":"{{ z4F2m.outputs.isFirst }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":72,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"FW2ke@z4F2m@_cdjo3-1@l@y",
			"id":"TWO8C",
			"index":10,
			"inputs":{
				"variables":[
					{
						"source":"{{ LpZOz.outputs.counter }}",
						"value":"{{ h9R03.outputs.result }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.record.columnData.items",
					"root.record.rowData.items",
					"root.record.metadata.appName"
				]
			},
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":72,
				"resourceName":"storage_by_unifyapps_create_record",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"z4F2m@_cdjo3-1@l",
			"id":"7txbk",
			"index":11,
			"inputs":{
				"writeThroughSessionVariables":false,
				"object_type":"citation_store",
				"skipIfBlank":false,
				"record":{
					"content":"{{ z4F2m.outputs.item.content }}",
					"metadata":"{{ z4F2m.outputs.item.chunkMetadata }}",
					"caseId":"{{ n_CtcTQ.outputs.caseId }}",
					"chunkNumber":"{{ h9R03.outputs.result }}",
					"hasMoreData":false,
					"tableIsPublished":false
				}
			},
			"skip":false,
			"subTitle":"Storage by UnifyApps",
			"title":"Create record",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.relevantContent.items",
					"root.parameters.columnData.items",
					"root.parameters.rowData.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":17,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"CWe4P",
			"index":12,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[
						"formattedOutput"
					],
					"properties":{
						"formattedOutput":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Formatted Output"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[
						"tavily"
					],
					"properties":{
						"counter":{
							"type":"integer",
							"title":"Counter"
						},
						"tavily":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Tavily"
						}
					}
				},
				"code":"def ctr = counter - 1\n\nif (binding.hasVariable('tavily')) {\n    def results = tavily.results\n    if (results != null && !results.isEmpty()) {\n        for (text in results) {\n            if (text?.content) {\n                ctr += 1\n                // assign the wrapped content directly, without .toString()\n                text.content = \"<chunk id=\\\"$ctr\\\">\\n*****\\n$text.content\\n*****\\n</chunk>\\n\".toString()\n            }\n        }\n    }\n}\n\nreturn [\n    \"formattedOutput\": tavily\n]",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"counter":"{{ LpZOz.outputs.counter }}",
					"tavily":"{{ RkGgx.outputs }}"
				}
			},
			"skip":false,
			"subTitle":"prepareOutput",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":169,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cdjo3-1",
			"id":"n_iPDOW",
			"index":13,
			"inputs":{
				"result":{
					"output":"{{ CWe4P.outputs.result.formattedOutput }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":0,
	"runtimeConnectionAppNames":[
		"tavily"
	],
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":false,
		"enableRunLogging":false,
		"enableVariableLogging":false,
		"route":{
			"default":false,
			"headerValueTierMap":{},
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		
	],
	"version":7
}